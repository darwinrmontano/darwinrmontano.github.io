<script>
  const spreadsheetId = "10fqQKjTzt1aMO-nTTzHYTDLJ8C5qHEIgGJjmkSmfHEY";
  const gidMapUrl = `https://opensheet.elk.sh/${spreadsheetId}/GIDMAP`;

  const selector = document.getElementById("dateSelector");
  const iframe = document.getElementById("sheetFrame");
  const gidMap = {};

  fetch(gidMapUrl)
    .then(response => response.json())
    .then(data => {
      data.forEach(row => {
        if (row.FECHA && row.GID) {
          gidMap[row.FECHA] = row.GID;
          const option = document.createElement("option");
          option.value = row.FECHA;
          option.textContent = row.FECHA;
          selector.appendChild(option);
        }
      });

      const today = new Date().toISOString().split("T")[0];
      if (gidMap[today]) {
        loadSheet(gidMap[today]);
        selector.value = today;
      }
    });

  function loadSheet(gid) {
    const url = `https://docs.google.com/spreadsheets/d/e/2PACX-1vT_SOmyJmpCUaj0oIQ5xgcZB-3AMPtBELZzCzzNZcN9eXfVPb1cq4MOc_dL41iphaopNvJnnmevgSxd/pubhtml?gid=${gid}&single=true`;
    iframe.src = url;
  }

  selector.addEventListener("change", () => {
    const selectedDate = selector.value;
    if (gidMap[selectedDate]) {
      loadSheet(gidMap[selectedDate]);
    }
  });

  document.getElementById("todayBtn").addEventListener("click", () => {
    const today = new Date().toISOString().split("T")[0];
    if (gidMap[today]) {
      selector.value = today;
      loadSheet(gidMap[today]);
    }
  });
</script>
