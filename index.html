<script>
  const SHEET_ID = '2PACX-1vT_SOmyJmpCUaj0oIQ5xgcZB-3AMPtBELZzCzzNZcN9eXfVPb1cq4MOc_dL41iphaopNvJnnmevgSxd';
  const GIDMAP_SHEET_ID = '10fqQKjZt1aMO-nTIzHYTDLU8C5qHElgGJmkSmfHEY';
  const GIDMAP_SHEET_GID = '2048853738';

  async function getGidForDate(date) {
    const formattedDate = date.toISOString().split('T')[0]; // yyyy-mm-dd
    const url = `https://docs.google.com/spreadsheets/d/${GIDMAP_SHEET_ID}/gviz/tq?tqx=out:json&gid=${GIDMAP_SHEET_GID}`;
    
    const res = await fetch(url);
    const text = await res.text();
    const json = JSON.parse(text.substr(47).slice(0, -2));
    const rows = json.table.rows;

    for (let row of rows) {
      const sheetDate = row.c[0]?.v;
      const gid = row.c[1]?.v?.toString();
      if (sheetDate === formattedDate) {
        return gid;
      }
    }
    return null;
  }

  async function loadSheetForDate(date) {
    const gid = await getGidForDate(date);
    if (!gid) {
      alert(`⚠️ No se encontró la hoja para: ${date.toISOString().split('T')[0]}\nAsegúrate de que esté en GIDMAP.`);
      return;
    }

    const iframe = document.createElement('iframe');
    iframe.src = `https://docs.google.com/spreadsheets/d/e/${SHEET_ID}/pubhtml?gid=${gid}&single=true`;
    iframe.width = "100%";
    iframe.height = "600px";
    iframe.style.border = "1px solid #ccc";

    const container = document.getElementById('sheet-container');
    container.innerHTML = '';
    container.appendChild(iframe);
  }

  window.addEventListener('DOMContentLoaded', () => {
    const datePicker = document.getElementById('datePicker');
    const todayBtn = document.getElementById('todayBtn');

    const today = new Date();
    datePicker.valueAsDate = today;
    loadSheetForDate(today);

    datePicker.addEventListener('change', () => {
      const selectedDate = new Date(datePicker.value);
      loadSheetForDate(selectedDate);
    });

    todayBtn.addEventListener('click', () => {
      const today = new Date();
      datePicker.valueAsDate = today;
      loadSheetForDate(today);
    });
  });
</script>
