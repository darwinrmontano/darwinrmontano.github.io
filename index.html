<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>📋 Maintenance Logs</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
      color: #333;
      text-align: center;
    }
    iframe {
      width: 100%;
      height: 600px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>📅 Maintenance Logs</h1>
  <iframe id="hoja" loading="lazy"></iframe>

  <script>
    const HOJA_ID = "10fqQKjZt1aMO-nTIzHYTDLU8C5qHElgGJmkSmfHEY"; // Tu ID de hoja de cálculo
    const GIDMAP_SHEET_GID = "289397948"; // GID de la hoja GIDMAP publicada

    function getToday() {
      const today = new Date();
      today.setMinutes(today.getMinutes() - today.getTimezoneOffset());
      return today.toISOString().split("T")[0]; // yyyy-MM-dd
    }

    function loadIframe(gid) {
      const url = `https://docs.google.com/spreadsheets/d/e/2PACX-1vT_SOmyJmpCUaj0oIQ5xgcZB-3AMPtBELZzCzzNZcN9eXfVPb1cq4MOc_dL41iphaopNvJnnmevgSxd/pubhtml?gid=${gid}&single=true&widget=true&headers=false`;
      document.getElementById("hoja").src = url;
    }

    async function buscarGID(fecha) {
      const urlCSV = `https://docs.google.com/spreadsheets/d/${HOJA_ID}/gviz/tq?tqx=out:csv&gid=${GIDMAP_SHEET_GID}`;
      const response = await fetch(urlCSV);
      const text = await response.text();
      const rows = text.trim().split("\n").map(line => line.split(","));

      for (let i = 1; i < rows.length; i++) {
        if (rows[i][0] === fecha) {
          return rows[i][1];
        }
      }
      return null;
    }

    (async () => {
      const fecha = getToday();
      const gid = await buscarGID(fecha);
      if (gid) {
        loadIframe(gid);
      } else {
        alert("⚠️ No se encontró la hoja para hoy.");
      }
    })();
  </script>
</body>
</html>
